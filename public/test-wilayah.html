<!DOCTYPE html>
<html>
<head>
    <title>Test Wilayah Dropdown</title>
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        select { width: 200px; padding: 8px; margin: 10px 0; }
        .disabled { background-color: #f5f5f5; }
        .debug { background: #f0f0f0; padding: 10px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>Test Wilayah Dropdown</h1>
    
    <div class="debug" id="debug">Debug info will appear here...</div>
    
    <div>
        <label>Provinsi:</label><br>
        <select id="province_id">
            <option value="">Pilih Provinsi</option>
            <option value="32">JAWA BARAT</option>
        </select>
    </div>
    
    <div>
        <label>Kabupaten/Kota:</label><br>
        <select id="regency_id" disabled>
            <option value="">Pilih Kabupaten/Kota</option>
        </select>
    </div>
    
    <div>
        <label>Kecamatan:</label><br>
        <select id="district_id" disabled>
            <option value="">Pilih Kecamatan</option>
        </select>
    </div>
    
    <div>
        <label>Kelurahan/Desa:</label><br>
        <select id="village_id" disabled>
            <option value="">Pilih Kelurahan/Desa</option>
        </select>
    </div>

    <script>
        const debug = document.getElementById('debug');
        
        function log(message) {
            console.log(message);
            debug.innerHTML += message + '<br>';
        }
        
        function resetSelect(selectElement, placeholder) {
            selectElement.innerHTML = `<option value="">${placeholder}</option>`;
            selectElement.disabled = true;
            selectElement.classList.add('disabled');
        }
        
        function enableSelect(selectElement) {
            selectElement.disabled = false;
            selectElement.classList.remove('disabled');
        }
        
        function loadRegencies(provinceId) {
            log(`Loading regencies for province: ${provinceId}`);
            const regencySelect = document.getElementById('regency_id');
            const districtSelect = document.getElementById('district_id');
            const villageSelect = document.getElementById('village_id');
            
            if (!provinceId) {
                resetSelect(regencySelect, 'Pilih Kabupaten/Kota');
                resetSelect(districtSelect, 'Pilih Kecamatan');
                resetSelect(villageSelect, 'Pilih Kelurahan/Desa');
                return;
            }
            
            fetch(`/wilayah/regencies/${provinceId}`)
                .then(response => {
                    log(`Regencies response status: ${response.status}`);
                    return response.json();
                })
                .then(data => {
                    log(`Regencies loaded: ${data.length} items`);
                    regencySelect.innerHTML = '<option value="">Pilih Kabupaten/Kota</option>';
                    data.forEach(regency => {
                        regencySelect.innerHTML += `<option value="${regency.id}">${regency.name}</option>`;
                    });
                    enableSelect(regencySelect);
                    resetSelect(districtSelect, 'Pilih Kecamatan');
                    resetSelect(villageSelect, 'Pilih Kelurahan/Desa');
                })
                .catch(error => {
                    log(`Error loading regencies: ${error.message}`);
                });
        }
        
        function loadDistricts(regencyId) {
            log(`Loading districts for regency: ${regencyId}`);
            const districtSelect = document.getElementById('district_id');
            const villageSelect = document.getElementById('village_id');
            
            if (!regencyId) {
                resetSelect(districtSelect, 'Pilih Kecamatan');
                resetSelect(villageSelect, 'Pilih Kelurahan/Desa');
                return;
            }
            
            fetch(`/wilayah/districts/${regencyId}`)
                .then(response => {
                    log(`Districts response status: ${response.status}`);
                    return response.json();
                })
                .then(data => {
                    log(`Districts loaded: ${data.length} items`);
                    districtSelect.innerHTML = '<option value="">Pilih Kecamatan</option>';
                    data.forEach(district => {
                        districtSelect.innerHTML += `<option value="${district.id}">${district.name}</option>`;
                    });
                    enableSelect(districtSelect);
                    resetSelect(villageSelect, 'Pilih Kelurahan/Desa');
                })
                .catch(error => {
                    log(`Error loading districts: ${error.message}`);
                });
        }
        
        function loadVillages(districtId) {
            log(`Loading villages for district: ${districtId}`);
            const villageSelect = document.getElementById('village_id');
            
            if (!districtId) {
                resetSelect(villageSelect, 'Pilih Kelurahan/Desa');
                return;
            }
            
            fetch(`/wilayah/villages/${districtId}`)
                .then(response => {
                    log(`Villages response status: ${response.status}`);
                    return response.json();
                })
                .then(data => {
                    log(`Villages loaded: ${data.length} items`);
                    villageSelect.innerHTML = '<option value="">Pilih Kelurahan/Desa</option>';
                    data.forEach(village => {
                        villageSelect.innerHTML += `<option value="${village.id}">${village.name}</option>`;
                    });
                    enableSelect(villageSelect);
                    log('Villages dropdown enabled successfully!');
                })
                .catch(error => {
                    log(`Error loading villages: ${error.message}`);
                });
        }
        
        // Event listeners
        document.getElementById('province_id').addEventListener('change', (e) => loadRegencies(e.target.value));
        document.getElementById('regency_id').addEventListener('change', (e) => loadDistricts(e.target.value));
        document.getElementById('district_id').addEventListener('change', (e) => loadVillages(e.target.value));
        
        log('Test page loaded. Select Provinsi to start.');
    </script>
</body>
</html>